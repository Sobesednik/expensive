{"version":3,"sources":["../../../src/lib/web/handle-request-ip.js"],"names":["LOG","handleRequestIP","message","appName","phone","user","_ip","exec","Error","ip","p","err","password","text"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;AACA;;;;AAEA,MAAMA,MAAM,oBAAS,WAAT,CAAZ;;AACA,MAAMC,kBAAkB,OAAOC,OAAP,EAAgB;AAAEC,SAAF;AAAWC,OAAX;AAAkBC;AAAlB,CAAhB,KAA6C;AACnE,QAAMC,MAAM,2BAA2BC,IAA3B,CAAgCL,OAAhC,CAAZ;;AACA,MAAI,CAACI,GAAL,EAAU,MAAM,IAAIE,KAAJ,CAAU,6CAAV,CAAN;AACV,QAAM,GAAGC,EAAH,IAASH,GAAf;AACA,MAAII,CAAJ;;AACA,MAAI;AACFA,QAAI,MAAM,oBAAO,IAAGP,OAAQ,WAAlB,CAAV;AACD,GAFD,CAEE,OAAOQ,GAAP,EAAY;AACZX,QAAI,4BAAJ,EAAkCG,OAAlC;AACD;;AACD,QAAMS,WAAWF,MAAK,MAAM,0BAAU;AACpCG,UAAO,gCAA+BJ,EAAG;AADL,GAAV,CAAX,CAAjB;AAIA,QAAM,2BAAa;AACjBJ,QADiB;AAEjBO,YAFiB;AAGjBH,MAHiB;AAIjBL;AAJiB,GAAb,CAAN;AAMD,CApBD;;eAsBeH,e","sourcesContent":["import { askSingle } from 'reloquent'\nimport bosom from 'bosom'\nimport authenticate from '../authenticate'\nimport { debuglog } from 'util'\n\nconst LOG = debuglog('expensive')\nconst handleRequestIP = async (message, { appName, phone, user }) => {\n  const _ip = /Invalid request IP: (.+)/.exec(message)\n  if (!_ip) throw new Error('Could not extract IP from the error message')\n  const [, ip] = _ip\n  let p\n  try {\n    p = await bosom(`.${appName}-password`)\n  } catch (err) {\n    LOG('%s password file not found', appName)\n  }\n  const password = p || await askSingle({\n    text: `Enter password to white-list ${ip}`,\n  })\n\n  await authenticate({\n    user,\n    password,\n    ip,\n    phone,\n  })\n}\n\nexport default handleRequestIP\n"],"file":"handle-request-ip.js"}