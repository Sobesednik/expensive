{"version":3,"sources":["../../src/bin/index.js"],"names":["LOG","DEBUG","test","process","env","NODE_DEBUG","domain","argv","u","console","log","exit","checkSingleWord","word","auth","domains","length","join","res","reportFree","freeDomains","free","total","reduce","f","t","tt","dd","isFree","some","d","it","percent","run","singleWord","phone","user","DefaultPhone","global","ApiUser","stack","message","props","colors","Errors","Number","authComplete","handleRequestIP","error","_ip","exec","Error","ip","password","text"],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n/* eslint-disable no-console */\nimport { c } from 'erte'\nimport { debuglog, inspect } from 'util'\nimport getUsage from './get-usage'\nimport { getConfig, checkDomains } from '..'\nimport { makeStartupyList, isSingleWord } from '../lib'\nimport authenticate from '../lib/authenticate'\nimport { askSingle } from 'reloquent'\n\nconst LOG = debuglog('expensive')\nconst DEBUG = /expensive/.test(process.env.NODE_DEBUG)\n\nconst [, , domain] = process.argv\n\nif (!domain) {\n  const u = getUsage()\n  console.log(u)\n  console.log()\n  process.exit(1)\n}\n\nconst checkSingleWord = async (word, auth) => {\n  const domains = makeStartupyList(word)\n  console.log('Checking %s domains: %s', domains.length, domains.join(', '))\n  const res = await checkDomains({\n    ...auth,\n    domains,\n  })\n  reportFree(domains, res)\n}\n\nconst reportFree = (domains, freeDomains) => {\n  const [free, , total] = domains.reduce(([f, t, tt], dd) => {\n    const isFree = freeDomains.some(d => d == dd)\n\n    const it = isFree ? c(dd, 'green') : c(dd, 'red')\n\n    return [\n      isFree ? [...f, it] : f,\n      isFree ? t : [...t, it],\n      [...tt, it],\n    ]\n  }, [[], [], []])\n\n  const percent = (free.length / total.length) * 100\n\n  console.log('%s', total.join(', '))\n  console.log('%s% are free', percent)\n}\n\nconst run = async () => {\n  const singleWord = isSingleWord(domain)\n  let phone\n  let user\n  try {\n    const { DefaultPhone, ...auth } = await getConfig({\n      global: true,\n    })\n    phone = DefaultPhone\n    user = auth.ApiUser\n    if (singleWord) {\n      await checkSingleWord(domain, auth)\n      return\n    }\n\n    console.log('Checking domain %s', domain)\n    const res = await checkDomains({\n      ...auth,\n      domain,\n    })\n    if (res.length) {\n      console.log('%s is free', c(domain, 'green'))\n    } else {\n      console.log('%s is taken', c(domain, 'red'))\n    }\n  } catch ({ stack, message, props }) {\n    if (props) {\n      LOG(inspect(props, { colors: true }))\n      LOG(Errors[props.Number])\n    }\n\n    if (props && props.Number == '1011150') {\n      const authComplete = await handleRequestIP(message, { phone, user })\n      if (authComplete === true) {\n        await run()\n      } else {\n        console.log(authComplete)\n      }\n      return\n    }\n\n    DEBUG ? LOG(stack) : console.error(message)\n    process.exit(1)\n  }\n}\n\nconst handleRequestIP = async (message, { phone, user }) => {\n  const _ip = /Invalid request IP: (.+)/.exec(message)\n  if (!_ip) throw new Error('Could not extract IP from the error message')\n  const [, ip] = _ip\n  const password = await askSingle({\n    text: `Enter password to white-list ${ip}`,\n  })\n  const res = await authenticate({\n    user,\n    password,\n    ip,\n    phone,\n  })\n  return res\n}\n\nconst Errors = {\n  1011150: 'Parameter RequestIP is invalid',\n}\n\n;(async () => {\n  await run()\n})()\n"],"file":"index.js"}